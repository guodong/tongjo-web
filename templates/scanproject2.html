{!extends file='layout.html'!} {!block name=main!}
<style>
.bodyer.wrapper{
width:100%;
}
</style>
<div class="scanprojecttwo">
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-3 col-md-3">
        <div class="leftMenu">
           <div class="title">
           <h1>所有项目</h1>
           </div>
           <hr>
           <div class="special">
           <ul>
           <li>推荐</li>
           <li>最新</li>
           <li>最热</li>
           <li>同校</li>
           </ul>
           </div>
           <div class="category">
            <div><span>项目分类</span></div>
            <div><button></button></div>
           </div>
           <div class="feature">
           <div><span>需求</span></div>
           </div>
           <div class="rank">
           <div><span>排序</span></div>
           </div>
        </div>
        </div>
        <div class="col-sm-9 col-md-9">
            <div class="well" ng-controller="scanController">
            <div ng-view></div>
            </div>
        </div>
    </div>
</div>
	<!-- 广告 -->
	<div style="margin-bottom: 20px;">
		<div id="carousel-example-generic" class="carousel slide"
			data-ride="carousel">
			<!-- Indicators -->
			<ol class="carousel-indicators">
				<li data-target="#carousel-example-generic" data-slide-to="0"
					class="active"></li>
				<li data-target="#carousel-example-generic" data-slide-to="1"></li>
				<li data-target="#carousel-example-generic" data-slide-to="2"></li>
			</ol>

			<!-- Wrapper for slides -->
			<div class="carousel-inner" role="listbox">
				<div class="item active">
					<img src="/img/index/header-bg-c96b5d9.jpg" alt="...">
					<div class="carousel-caption">项目是指一系列独特的、复杂的并相互关联的活动，这些活动有着一个明确的目标或目的，必须在特定的时间、预算、资源限定内，依据规范完成</div>
				</div>
				<div class="item">
					<img src="/img/index/header-bg-c96b5d9.jpg" alt="...">
					<div class="carousel-caption">项目是指一系列独特的、复杂的并相互关联的活动，这些活动有着一个明确的目标或目的，必须在特定的时间、预算、资源限定内，依据规范完成</div>
				</div>
				<div class="item">
					<img src="/img/index/header-bg-c96b5d9.jpg" alt="...">
					<div class="carousel-caption">项目是指一系列独特的、复杂的并相互关联的活动，这些活动有着一个明确的目标或目的，必须在特定的时间、预算、资源限定内，依据规范完成</div>
				</div>
			</div>
			<!-- Controls -->
			<a class="left carousel-control" href="#carousel-example-generic"
				role="button" data-slide="prev"> <span
				class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
				<span class="sr-only">Previous</span>
			</a> <a class="right carousel-control" href="#carousel-example-generic"
				role="button" data-slide="next"> <span
				class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
				<span class="sr-only">Next</span>
			</a>
		</div>
	</div>
	<!-- 推荐 -->
	<div class="recomd" ng-controller="recomController">
	<section class="tech">
	<div class="clear clearfix">
		<h2 class="title">推荐项目</h2>
		<p ng-show="!recomProLoaded">加载中...</p>
		<article ng-repeat="project in projects track by $index">
			<span ng-mouseover="hoverIn()" ng-mouseleave="hoverOut()">
			 <img ng-src="{{project.image|defaultImg}}">
				<div class="transparent_class" ng-show="hoverEdit">
					<p ng-bind="project.description|defaultDescription"></p>
					<a class="small-button red" href="{{project.link}}">查看项目详情</a>
				</div>
				<h5 class="transparent_class" ng-bind="project.title"></h5>
			</span>			
		</article>
	</div>
	<div style="overflow:hidden">
	<a class="more" ng-click="change()">换一组</a>
	</div>	
</section>
</div>
<!-- 分类 -->
<div class="navigation" ng-controller="navController">
<div class="navigation-first">
	<div class="wrapper">
			<a ng-class="{current:isActive(1,categoryId)}" href="#category-1/1" ng-click="menuClick(1)">
			    IT互联网
				<div ng-class="{line:isActive(1,categoryId)}"></div>
				<div ng-class="{arrow:isActive(1,categoryId)}"></div>
			</a>
			<a ng-class="{current:isActive(2,categoryId)}" href="#category-2/9" ng-click="menuClick(2)">
			   设计
				<div ng-class="{line:isActive(2,categoryId)}"></div>
				<div ng-class="{arrow:isActive(2,categoryId)}"></div>
			</a>
			<a ng-class="{current:isActive(3,categoryId)}" href="#category-3/19" ng-click="menuClick(3)">
			   市场
				<div ng-class="{line:isActive(3,categoryId)}"></div>
				<div ng-class="{arrow:isActive(3,categoryId)}"></div>
			</a>
			<a ng-class="{current:isActive(4,categoryId)}" href="#category-4/23" ng-click="menuClick(4)">
			   校园创业
				<div ng-class="{line:isActive(4,categoryId)}"></div>
				<div ng-class="{arrow:isActive(4,categoryId)}"></div>
			</a>
			<a ng-class="{current:isActive(5,categoryId)}" href="#category-5/28" ng-click="menuClick(5)">
				校园生活创意
				<div ng-class="{line:isActive(5,categoryId)}"></div>
				<div ng-class="{arrow:isActive(5,categoryId)}"></div>
			</a>
			<a ng-class="{current:isActive(6,categoryId)}" href="#category-6/31" ng-click="menuClick(6)">
			   	比赛
				<div ng-class="{line:isActive(6,categoryId)}"></div>
				<div ng-class="{arrow:isActive(6,categoryId)}"></div>
			</a>							
	</div>
</div>
<div class="navigation-second">
 	<div class="wrapper">	 	
		<ul>
		<li ng-repeat = "subcategory in subcategorys">
		<a ng-class="{current:isActive(subcategory.subcategoryId,subcategoryId)}" href="{{subcategory.href}}" ng-click="submenuClick(subcategory.subcategoryId)" ng-bind="subcategory.name">
		</a>
		</li>			
		</ul>
	</div>
</div>
<div class="navigation-third">
<div class="container navcenter">
<div class="row">
<div class="centerline col-sm-3"></div>
<div class="col-sm-6 border">
<a ng-class="{current:isActive(2,isNewHot)}" href="#special-2" ng-click="newhotClick(2)">最新</a>
<span>|</span>
<a ng-class="{current:isActive(3,isNewHot)}" href="#special-3" ng-click="newhotClick(3)">最热</a>
<span>|</span>
<a ng-class="{current:isActive(4,isNewHot)}" href="#special-4" ng-click="newhotClick(4)">同校</a>
</div>
<div class="centerline col-sm-3"></div>
</div>
</div>
</div>
</div>
<div class="content" ng-controller="scanController">
<div ng-view></div>
</div>
</div>
<script>
	require(
			['angular', 'angular-route', 'angular-resource','ui-bootstrap'],
			function(angular,route,bootstrap) {
				var scanApp = angular.module('scanApp',['ngRoute','ngResource','ui.bootstrap']);
				
				scanApp.config(['$routeProvider',function($routeProvider){
					$routeProvider.when('/',{
						templateUrl:'scanproject-tpl',
						controller:'defaultCtl'
					}).when('/special-:specialId',{
						templateUrl:'scanproject-tpl',
						controller:'defaultCtl'
					}).when('/category-:categoryId',{
						templateUrl:'scanproject-tpl',
						controller:'categoryCtl'
					}).when('/category-:categoryId/:subcategoryId',{
						templateUrl:'scanproject-tpl',
						controller:'categoryCtl'
					}).otherwise({
						redirectTo:'/'
					});		
				}]);
				
				scanApp.controller('defaultCtl',function($scope,$routeParams, $resource){
					//TODO 获得数据
					//$scope.projects = projects;
					$scope.projectLoaded = false;
				    var Project = $resource(API + 'project');
					var projects = Project.query(function() {
							$scope.projects = projects;
							$scope.projectLoaded = true;
					});
				});
				
				scanApp.controller('categoryCtl',function($scope,$routeParams, $resource){
					//TODO 获得数据
					$scope.projectLoaded = false;
				    var Project = $resource(API + 'category/:categoryId/project');
					var projects = Project.query({categoryId: 2}, function() {
							$scope.projects = projects;
							$scope.projectLoaded = true;
					});
					$scope.page.index = 1;
				});
				var specialTitle = new Array("最热项目","最新项目","推荐项目");
				var categoryTitle = new Array("技术","设计","商业市场","校园创业","创意","公益","比赛");
				var subcategoryArrays= new Array(
						[{subcategoryId:1,name:"数据分析",href:"#category-1/1"},
						 {subcategoryId:2,name:"信息通信",href:"#category-1/2"},
						 {subcategoryId:3,name:"移动互联网",href:"#category-1/3"},
						 {subcategoryId:4,name:"智能硬件",href:"#category-1/4"},
						 {subcategoryId:5,name:"自动化",href:"#category-1/5"},
						 {subcategoryId:6,name:"网站开发",href:"#category-1/6"},
						 {subcategoryId:7,name:"软件开发",href:"#category-1/7"},
						 {subcategoryId:8,name:"其他",href:"#category-1/8"}],
						[{subcategoryId:9,name:"艺术设计",href:"#category-2/9"},
							 {subcategoryId:10,name:"交互设计",href:"#category-2/10"},
							 {subcategoryId:11,name:"网页设计",href:"#category-2/11"},
							 {subcategoryId:12,name:"动画设计",href:"#category-2/12"},
							 {subcategoryId:13,name:"建筑设计",href:"#category-2/13"},
							 {subcategoryId:14,name:"产品设计",href:"#category-2/14"},
							 {subcategoryId:15,name:"电子设计",href:"#category-2/15"},
							 {subcategoryId:16,name:"机械设计",href:"#category-2/16"},
							 {subcategoryId:17,name:"服装设计",href:"#category-2/17"},
							 {subcategoryId:18,name:"其他",href:"#category-2/18"}],
								[{subcategoryId:19,name:"营销策划",href:"#category-3/19"},
								 {subcategoryId:20,name:"广告创意",href:"#category-3/20"},
								 {subcategoryId:21,name:"创意视频",href:"#category-3/21"},
								 {subcategoryId:22,name:"其他",href:"#category-3/22"}],
								[{subcategoryId:23,name:"本地生活",href:"#category-4/23"},
								 {subcategoryId:24,name:"社交类",href:"#category-4/24"},
								 {subcategoryId:25,name:"技术创新",href:"#category-4/25"},
								 {subcategoryId:26,name:"服务类",href:"#category-4/26"},
								 {subcategoryId:27,name:"其他",href:"#category-4/27"}],
						[{subcategoryId:28,name:"志愿者活动",href:"#category-5/28"},
						 {subcategoryId:29,name:"爱的基金",href:"#category-5/29"},
						 {subcategoryId:30,name:"其他",href:"#category-5/30"}],
							[{subcategoryId:31,name:"创业比赛",href:"#category-6/31"},
							 {subcategoryId:32,name:"设计比赛",href:"#category-6/32"},
							 {subcategoryId:33,name:"技能比赛",href:"#category-6/33"},
							 {subcategoryId:34,name:"学科竞赛",href:"#category-6/34"},
							 {subcategoryId:35,name:"营销竞赛",href:"#category-6/35"},
							 {subcategoryId:36,name:"其他",href:"#category-6/36"}]
						);
				scanApp.controller("recomController",["$scope",'$resource',function($scope,$resource){
					//get recommendation projects
					$scope.recomProLoaded = false;
					var RecomProject = $resource(API + 'project');
					var recomProjects = RecomProject.query(function() {
							$scope.projects = recomProjects.slice($scope.recomdBatchStart,$scope.recomdBatchStart + 4);
							$scope.recomProLoaded = true;
					});
					
					$scope.recomdBatchStart = 1;
					$scope.hoverIn = function(){
					    this.hoverEdit = true;
					};

					$scope.hoverOut = function(){
					    this.hoverEdit = false;
					};
					
					$scope.change = function () {  
						//TODO 获取更多数据
					    $scope.recomdBatchStart =  ($scope.recomdBatchStart + 4) % recomProjects.length;
					    console.log($scope.recomdBatchStart);
					    if($scope.recomdBatchStart + 4 < recomProjects.length)
							$scope.projects = recomProjects.slice($scope.recomdBatchStart,$scope.recomdBatchStart + 4);
						else{
							$scope.projects = recomProjects.slice($scope.recomdBatchStart,recomProjects.length);
							$scope.projects = $scope.projects.concat(recomProjects.slice(0,($scope.recomdBatchStart + 4)%recomProjects.length));
						}
				   }
					
				}]);
				scanApp.controller("navController",["$scope",function($scope){
					$scope.categoryId = 1;
					$scope.subcategorys = subcategoryArrays[0];
					$scope.subcategoryId = subcategoryArrays[0][0].subcategoryId;
					location.href="#category-1/1";
					
					$scope.menuClick = function(categoryId){
						$scope.categoryId = categoryId;
						$scope.subcategorys = subcategoryArrays[categoryId-1];
						$scope.subcategoryId = subcategoryArrays[categoryId-1][0].subcategoryId;
					}
					$scope.submenuClick = function(subcategoryId){
						$scope.subcategoryId = subcategoryId;
					}
					$scope.newhotClick = function(newhot){
						$scope.isNewHot = newhot;
						$scope.subcategoryId = 0;
					}
					$scope.isActive = function(self, current){
						if(self == current)
							return true;
						else return false;
					}
				}]);
				scanApp.controller("scanController", ["$scope", function ($scope) {
					$scope.page = {
						    size: 8,
						    index: 1
				    };
					$scope.hoverIn = function(){
					    this.hoverEdit = true;
					};

					$scope.hoverOut = function(){
					    this.hoverEdit = false;
					};
					

				}]);
				scanApp.filter('size', function() {
					  return function (items) {
					    if (!items)
					      return 0;
					    return items.length || 0
					  }
			   });
			   scanApp.filter('paging', function() {
					 return function (items, index, pageSize) {
					    if (!items)
					      return [];
					    var offset = (index - 1) * pageSize;
					    return items.slice(offset, offset + pageSize);
					 }
			  });
			   scanApp.filter('defaultImg',function(){
				   return function(item){
					   if(item==null || item =="")
						   return "/img/market.png";
					   else return "http://api.tongjo.com/files/"+item;
				   }
			   });
			   scanApp.filter('defaultDescription',function(){
				   return function(item){
					   console.log("item:"+item);
					   if(item==null || item =="")
						   return "项目是指一系列独特的、复杂的并相互关联的活动，这些活动有着一个明确的目标或目的，必须在特定的时间、预算、资源限定内，依据规范完成";
					   else  return $($.parseHTML(item)).text();
					   
				   }
			   });
			   angular.bootstrap(document.getElementById("body"), [ 'scanApp' ]);
			});
</script>
{!/block!}