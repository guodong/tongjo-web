{!extends file='layout.html'!} {!block name=main!}
<style>
.navbar {
	margin-bottom: 0px;
}

.bodyer {
	margin-top: 0px;
}

.bodyer.wrapper {
	width: 100%;
}
</style>
<div class="scanprojecttwo">
	<div class="container-fluid">
		<div class="mainpanel">
			<div class="left-nav" ng-controller="navController">
				<div class="special nav-section">
					<div>
						<div>
							<a href="#special-1"
								ng-class="{current:isActive(1,$root.specialId)}"><span class="icon-recom"></span>推荐</a>
						</div>
						<div>
							<a href="#special-2"
								ng-class="{current:isActive(2,$root.specialId)}"><span class="icon-new"></span>最新</a>
						</div>
						<div>
							<a href="#special-3"
								ng-class="{current:isActive(3,$root.specialId)}"><span class="icon-hot"></span>最热</a>
						</div>
						<!--  <div>
							<a href="#special-4"
								ng-class="{current:isActive(4,$root.specialId)}">同校</a>
						</div> -->
					</div>
				</div>
				<div class="category nav-section">
					<div class="title">
						<span>类别</span>
					</div>
					<div class="dropdown">
						<a role="button" data-toggle="dropdown"
							class="btn btn-default cate-button" data-target="#"> <span
							ng-bind="$root.cateTitle">全部</span> <span class="caret"></span>
						</a>
						<ul class="dropdown-menu multi-level" role="menu"
							aria-labelledby="dropdownMenu">
							<li><a tabindex="-1" href="#/">全部</a></li>
							<li class="dropdown-submenu"><a tabindex="-1"
								href="#category-1">IT互联网</a>
								<ul class="dropdown-menu">
									<li><a href="#category-1/2">数据分析</a></li>
									<li><a href="#category-1/3">信息通信</a></li>
									<li><a href="#category-1/4">移动互联网</a></li>
									<li><a href="#category-1/5">智能硬件</a></li>
									<li><a href="#category-1/6">嵌入式开发</a></li>
									<li><a href="#category-1/7">网站开发</a></li>
									<li><a href="#category-1/8">软件开发</a></li>
									<li><a href="#category-1/9">游戏开发</a></li>
									<li><a href="#category-1/10">其他</a></li>
								</ul></li>
							<li class="dropdown-submenu"><a tabindex="-1"
								href="#category-11">设计</a>
								<ul class="dropdown-menu">
									<li><a href="#category-11/12">艺术设计</a></li>
									<li><a href="#category-11/13">交互设计</a></li>
									<li><a href="#category-11/14">网页设计</a></li>
									<li><a href="#category-11/15">动画设计</a></li>
									<li><a href="#category-11/16">建筑设计</a></li>
									<li><a href="#category-11/17">产品设计</a></li>
									<li><a href="#category-11/18">电子工业设计</a></li>
									<li><a href="#category-11/19">机械设计</a></li>
									<li><a href="#category-11/20">服装设计</a></li>
									<li><a href="#category-11/21">其他</a></li>
								</ul></li>
							<li class="dropdown-submenu"><a tabindex="-1"
								href="#category-22">市场</a>
								<ul class="dropdown-menu">
									<li><a href="#category-22/23">营销策划</a></li>
									<li><a href="#category-22/24">广告创意</a></li>
									<li><a href="#category-22/25">宣传视频</a></li>
									<li><a href="#category-22/26">其他</a></li>
								</ul></li>
							<li class="dropdown-submenu"><a tabindex="-1"
								href="#category-27">校园创业</a>
								<ul class="dropdown-menu">
									<li><a href="#category-27/28">本地生活</a></li>
									<li><a href="#category-27/29">社交类</a></li>
									<li><a href="#category-27/30">技术创新</a></li>
									<li><a href="#category-27/31">服务类</a></li>
								</ul></li>
							<li class="dropdown-submenu"><a tabindex="-1"
								href="#category-32">校园生活创意</a>
								<ul class="dropdown-menu">
									<li><a href="#category-32/33">绿色节能</a></li>
									<li><a href="#category-32/34">新文化</a></li>
									<li><a href="#category-32/35">新社团</a></li>
									<li><a href="#category-32/36">其他</a></li>
								</ul></li>
						   <li class="dropdown-submenu"><a tabindex="-1"
								href="#category-37">公益</a>
								<ul class="dropdown-menu">
									<li><a href="#category-37/38">志愿者活动</a></li>
									<li><a href="#category-37/39">爱的基金</a></li>
									<li><a href="#category-37/40">其他</a></li>
								</ul></li>
							<li class="dropdown-submenu"><a tabindex="-1"
								href="#category-41">比赛</a>
								<ul class="dropdown-menu">
									<li><a href="#category-41/42">创业比赛</a></li>
									<li><a href="#category-41/43">设计比赛</a></li>
									<li><a href="#category-41/44">技能比赛</a></li>
									<li><a href="#category-41/45">学科竞赛</a></li>
									<li><a href="#category-41/46">营销竞赛</a></li>
									<li><a href="#category-41/47">其他比赛</a></li>
								</ul></li>
						</ul>
					</div>
				</div>
				<!-- <div class="filter nav-section">
					<div class="title">
						<span>筛选</span>
					</div>
					<div>
						<div class="checkbox">
							<label><input type="checkbox">同校</label>
						</div>
						<div class="checkbox">
							<label><input type="checkbox">异校</label>
						</div>
						<div class="checkbox">
							<label><input type="checkbox">团队</label>
						</div>
						<div class="checkbox">
							<label><input type="checkbox">个人</label>
						</div>
					</div>
				</div> -->
				<!-- <div class="feature">
           <div><span>需求</span></div>
           </div>
           <div class="rank">
           <div><span>排序</span></div>
           </div>-->
			</div>
			<div class="rightpanel">
				<div ng-controller="scanController">
					<div ng-view></div>
				</div>
			</div>
		</div>
	</div>
</div>
<script>
	require(
			[ 'angular', 'angular-route', 'angular-resource', 'ui-bootstrap',
					'infinite-scroll' ],
			function(angular, route, bootstrap) {
				var categoryArrays = new Array({
					name : "IT互联网",
					href : "#category－1"
				}, {
					name : "数据分析",
					href : "#category-1/2"
				}, {
					name : "信息通信",
					href : "#category-1/3"
				}, {
					name : "移动互联网",
					href : "#category-1/4"
				}, {
					name : "智能硬件",
					href : "#category-1/5"
				}, {
					name : "嵌入式开发",
					href : "#category-1/6"
				}, {
					name : "网站开发",
					href : "#category-1/7"
				}, {
					name : "软件开发",
					href : "#category-1/8"
				}, {
					name : "游戏开发",
					href : "#category-1/9"
				}, {
					name : "IT互联网－其他",
					href : "#category-1/10"
				}, {
					name : "设计",
					href : "#category-11"
				}, {
					name : "艺术设计",
					href : "#category-11/12"
				}, {
					name : "交互设计",
					href : "#category-11/13"
				}, {
					name : "网页设计",
					href : "#category-11/14"
				}, {
					name : "动画设计",
					href : "#category-11/15"
				}, {
					name : "建筑设计",
					href : "#category-11/16"
				}, {
					name : "产品设计",
					href : "#category-11/17"
				}, {
					name : "电子工业设计",
					href : "#category-11/18"
				}, {
					name : "机械设计",
					href : "#category-11/19"
				}, {
					name : "服装设计",
					href : "#category-11/20"
				}, {
					name : "设计－其他",
					href : "#category-11/21"
				}, {
					name : "市场",
					href : "#category-22"
				}, {
					name : "营销策划",
					href : "#category-22/23"
				}, {
					name : "广告创意",
					href : "#category-22/24"
				}, {
					name : "宣传视频",
					href : "#category-22/25"
				}, {
					name : "市场－其他",
					href : "#category-22/26"
				}, {
					name : "校园创业",
					href : "#category-27"
				}, {
					name : "本地生活",
					href : "#category-27/28"
				}, {
					name : "社交类",
					href : "#category-27/29"
				}, {
					name : "技术创新",
					href : "#category-27/30"
				}, {
					name : "服务类",
					href : "#category-27/31"
				},{
					name : "校园生活创意",
					href : "#category-32"
				}, {
					name : "绿色节能",
					href : "#category-32/33"
				}, {
					name : "新文化",
					href : "#category-32/34"
				}, {
					name : "新社团",
					href : "#category-32/35"
				}, {
					name : "校园生活创意－其他",
					href : "#category-32/36"
				}, {
					name : "公益",
					href : "#category-39"
				}, {
					name : "志愿者活动",
					href : "#category-39/40"
				}, {
					name : "爱的基金",
					href : "#category-39/41"
				}, {
					name : "公益－其他",
					href : "#category-39/41"
				}, {
					name : "比赛",
					href : "#category-41"
				}, {
					name : "创业比赛",
					href : "#category-41/42"
				}, {
					name : "设计比赛",
					href : "#category-41/43"
				}, {
					name : "技能比赛",
					href : "#category-41/44"
				}, {
					name : "学科竞赛",
					href : "#category-41/45"
				}, {
					name : "营销竞赛",
					href : "#category-41/46"
				}, {
					name : "比赛－其他",
					href : "#category-41/47"
				});
				var scanApp = angular.module('scanApp', [ 'ngRoute',
						'ngResource', 'ui.bootstrap', 'infinite-scroll' ]);

				scanApp.config([ '$routeProvider', function($routeProvider) {
					$routeProvider.when('/', {
						templateUrl : 'scanproject-index-tpl',
						controller : 'defaultCtl',
					}).when('/special-:specialId', {
						templateUrl : 'scanproject-tpl',
						controller : 'specialCtl'
					}).when('/category-:categoryId', {
						templateUrl : 'scanproject-tpl',
						controller : 'categoryCtl'
					}).when('/category-:facategoryId/:categoryId', {
						templateUrl : 'scanproject-tpl',
						controller : 'categoryCtl'
					}).otherwise({
						redirectTo : '/'
					});
				} ]);
				scanApp.controller("navController", [ "$scope",
						function($scope, $rootScope) {
							$scope.specialClick = function(specialId) {
								$scope.specialId = specialId;
							}
							$scope.isActive = function(self, current) {
								if (self == current)
									return true;
								else
									return false;
							}
						} ]);
				scanApp.controller('defaultCtl', function($scope, $rootScope,
						$routeParams, $resource) {
					$rootScope.cateTitle = "全部";
					$rootScope.specialId = -1;
					//$scope.cateTitle = "全部123";
					//TODO 获得数据
					//$scope.projects = projects;
					$scope.projectLoaded = false;
					var Project = $resource(API + 'project');
					var projects = Project.query(function() {
						$scope.projects = projects;
						$scope.projectLoaded = true;
					});
				});
				scanApp.controller('specialCtl', function($scope, $rootScope,
						$routeParams, $resource) {
					//TODO 获得数据
					$rootScope.cateTitle = "全部";
					if ($routeParams.specialId != null)
						$rootScope.specialId = $routeParams.specialId;
					var last = -1;
					$scope.view_projects = new Array();
					$scope.projectLoaded = false;
					var Project = $resource(API + 'project');
					var projects = Project.query({
						categoryId : 2
					}, function() {
						$scope.projects = projects;
						$scope.projectLoaded = true;
						for ( var i = 1; i <= 8; i++) {
							if (last + i < $scope.projects.length)
								$scope.view_projects.push($scope.projects[last
										+ i]);
						}
						last = $scope.view_projects.length - 1;
					});
					$scope.loadMore = function() {
						if ($scope.projects != null) {
							for ( var i = 1; i <= 8; i++) {
								if (last + i < $scope.projects.length)
									$scope.view_projects
											.push($scope.projects[last + i]);
							}
							last = $scope.view_projects.length - 1;
						}
					};
				});
				scanApp
						.controller(
								'categoryCtl',
								function($scope, $rootScope, $routeParams,
										$resource) {
									//修改分类标题
									if ($routeParams.specialId != null) {
										$rootScope.cateTitle = "全部";
										$rootScope.specialId = $routeParams.specialId;
									} else if ($routeParams.facategoryId != null && $routeParams.categoryId != null) {
										$rootScope.specialId = -1;
										$rootScope.cateTitle = categoryArrays[$routeParams.categoryId - 1].name;
									} else if ($routeParams.categoryId != null) {
										$rootScope.specialId = -1;
										$rootScope.cateTitle = categoryArrays[$routeParams.categoryId - 1].name;
									}
									var last = -1;
									$scope.view_projects = new Array();
									$scope.projectLoaded = false;
									var Project = $resource(API
											+ 'category/:categoryId/project');
									var projects = Project
											.query(
													{
														categoryId : $routeParams.categoryId
													},
													function() {
														$scope.projects = projects;
														$scope.projectLoaded = true;
														for ( var i = 1; i <= 8; i++) {
															if (last + i < $scope.projects.length)
																$scope.view_projects
																		.push($scope.projects[last
																				+ i]);
														}
														last = $scope.view_projects.length - 1;
													});
									$scope.loadMore = function() {
										if ($scope.projects != null) {
											for ( var i = 1; i <= 8; i++) {
												if (last + i < $scope.projects.length)
													$scope.view_projects
															.push($scope.projects[last
																	+ i]);
											}
											last = $scope.view_projects.length - 1;
										}
									};
								});
				scanApp.controller("scanController", [ "$scope",
						function($scope) {
							$scope.page = {
								size : 8,
								index : 1
							};
							$scope.hoverIn = function() {
								this.hoverEdit = true;
							};

							$scope.hoverOut = function() {
								this.hoverEdit = false;
							};
						} ]);
				scanApp.filter('size', function() {
					return function(items) {
						if (!items)
							return 0;
						return items.length || 0
					}
				});
				scanApp.filter('paging', function() {
					return function(items, index, pageSize) {
						if (!items)
							return [];
						var offset = (index - 1) * pageSize;
						return items.slice(offset, offset + pageSize);
					}
				});
				scanApp.filter('defaultImg', function() {
					return function(item) {
						if (item == null || item == "")
							return "/img/market.png";
						else
							return "http://api.tongjo.com/files/" + item;
					}
				});
				scanApp
						.filter(
								'defaultDescription',
								function() {
									return function(item) {
										if (item == null || item == "")
											//return "项目是指一系列独特的、复杂的并相互关联的活动，这些活动有着一个明确的目标或目的，必须在特定的时间、预算、资源限定内，依据规范完成";
										    return "";
										else
											return $($.parseHTML(item)).text();

									}
								});
				angular.bootstrap(document.getElementById("body"),
						[ 'scanApp' ]);
			});
</script>
{!/block!}