{!extends file='layout.html'!} {!block name=main!}
<style>
.navbar {
margin-bottom: 0px;
}
.bodyer {
margin-top: 0px;
}
.bodyer.wrapper{
width:100%;
}
</style>
<div class="scanprojecttwo">
<div class="container-fluid">
<div class="mainpanel">
        <div class="left-nav" ng-controller="navController">
           <div class="special nav-section">
           <div>
           <div><a href="#special-1" ng-class="{current:isActive(1,specialId)}" ng-click="specialClick(1)">推荐</a></div>
           <div><a href="#special-2" ng-class="{current:isActive(2,specialId)}" ng-click="specialClick(2)">最新</a></div>
           <div><a href="#special-3" ng-class="{current:isActive(3,specialId)}" ng-click="specialClick(3)">最热</a></div>
           <div><a href="#special-4" ng-class="{current:isActive(4,specialId)}"ng-click="specialClick(4)">同校</a></div>
           </div>
           </div>
           <div class="category nav-section">
            <div class="title"><span>类别</span></div>
            <div class="dropdown">
            <a role="button" data-toggle="dropdown" class="btn btn-default cate-button" data-target="#">
                <span ng-bind="$root.cateTitle">全部</span> <span class="caret"></span>
            </a>
    		<ul class="dropdown-menu multi-level" role="menu" aria-labelledby="dropdownMenu">
    		  <li>
                <a tabindex="-1" href="#/">全部</a>
              </li>
              <li class="dropdown-submenu">
                <a tabindex="-1" href="#category-1">IT互联网</a>
                <ul class="dropdown-menu">
                  <li><a href="#category-1/1">数据分析</a></li>
                  <li><a href="#category-1/2">信息通信</a></li>	
                  <li><a href="#category-1/3">移动互联网</a></li>	
                  <li><a href="#category-1/4">智能硬件</a></li>	
                  <li><a href="#category-1/5">自动化</a></li>	
                  <li><a href="#category-1/6">网站开发</a></li>	
                  <li><a href="#category-1/7">软件开发</a></li>
                  <li><a href="#category-1/8">其他</a></li>
                </ul>
              </li>
              <li class="dropdown-submenu">
                <a tabindex="-1" href="#category-2">设计</a>
                <ul class="dropdown-menu">
                  <li><a href="#category-2/9">艺术设计</a></li>
                  <li><a href="#category-2/10">交互设计</a></li>	
                  <li><a href="#category-2/11">网页设计</a></li>	
                  <li><a href="#category-2/12">动画设计</a></li>	
                  <li><a href="#category-2/13">建筑设计</a></li>	
                  <li><a href="#category-2/14">产品设计</a></li>	
                  <li><a href="#category-2/15">电子设计</a></li>
                  <li><a href="#category-2/16">机械设计</a></li>
                  <li><a href="#category-2/17">服装设计</a></li>
                  <li><a href="#category-2/18">其他</a></li>
                </ul>
              </li>
              <li class="dropdown-submenu">
                <a tabindex="-1" href="#category-3">市场</a>
                <ul class="dropdown-menu">
                  <li><a href="#category-3/19">营销策划</a></li>
                  <li><a href="#category-3/20">广告创意</a></li>	
                  <li><a href="#category-3/21">创意视频</a></li>	
                  <li><a href="#category-3/22">其他</a></li>
                </ul>
              </li>
              <li class="dropdown-submenu">
                <a tabindex="-1" href="#category-4">校园创业</a>
                <ul class="dropdown-menu">
                  <li><a href="#category-4/23">本地生活</a></li>
                  <li><a href="#category-4/24">社交类</a></li>	
                  <li><a href="#category-4/25">技术创新</a></li>	
                  <li><a href="#category-4/26">服务类</a></li>
                  <li><a href="#category-4/27">其他</a></li>
                </ul>
              </li>
             <li class="dropdown-submenu">
                <a tabindex="-1" href="#category-5">校园生活创意</a>
                <ul class="dropdown-menu">
                <li><a href="#category-5/28">志愿者活动</a></li>
                  <li><a href="#category-5/29">爱的基金</a></li>	
                  <li><a href="#category-5/30">其他</a></li>
                </ul>
              </li>
             <li class="dropdown-submenu">
                <a tabindex="-1" href="#category-6">比赛</a>
                <ul class="dropdown-menu">
                  <li><a href="#category-6/31">创业比赛</a></li>
                  <li><a href="#category-6/32">设计比赛</a></li>	
                  <li><a href="#category-6/33">技能比赛</a></li>	
                  <li><a href="#category-6/34">学科竞赛</a></li>	
                  <li><a href="#category-6/35">营销竞赛</a></li>	
                  <li><a href="#category-6/36">其他</a></li>
                </ul>
              </li>
            </ul>
        </div>
       </div>
           <div class="filter nav-section">
           <div class="title"><span>筛选</span></div>
           <div>
           <div class="checkbox"><label><input type="checkbox">同校</label></div>
           <div class="checkbox"><label><input type="checkbox">异校</label></div>
           <div class="checkbox"><label><input type="checkbox">团队</label></div>
           <div class="checkbox"><label><input type="checkbox">个人</label></div>
           </div>
           </div>
           <!-- <div class="feature">
           <div><span>需求</span></div>
           </div>
           <div class="rank">
           <div><span>排序</span></div>
           </div>-->
        </div>
        <div class="rightpanel">
            <div ng-controller="scanController">
            <div ng-view></div>
            </div>
        </div>
        </div>
</div>
</div>
<script>
	require(
			['angular', 'angular-route', 'angular-resource','ui-bootstrap','infinite-scroll'],
			function(angular,route,bootstrap) {
				var categoryTitle = new Array("IT互联网","设计","市场","校园创业","校园生活创意","比赛");
				var subcategoryArrays= new Array(
						{subcategoryId:1,name:"数据分析",href:"#category-1/1"},
						 {subcategoryId:2,name:"信息通信",href:"#category-1/2"},
						 {subcategoryId:3,name:"移动互联网",href:"#category-1/3"},
						 {subcategoryId:4,name:"智能硬件",href:"#category-1/4"},
						 {subcategoryId:5,name:"自动化",href:"#category-1/5"},
						 {subcategoryId:6,name:"网站开发",href:"#category-1/6"},
						 {subcategoryId:7,name:"软件开发",href:"#category-1/7"},
						 {subcategoryId:8,name:"IT互联网－其他",href:"#category-1/8"},
						{subcategoryId:9,name:"艺术设计",href:"#category-2/9"},
							 {subcategoryId:10,name:"交互设计",href:"#category-2/10"},
							 {subcategoryId:11,name:"网页设计",href:"#category-2/11"},
							 {subcategoryId:12,name:"动画设计",href:"#category-2/12"},
							 {subcategoryId:13,name:"建筑设计",href:"#category-2/13"},
							 {subcategoryId:14,name:"产品设计",href:"#category-2/14"},
							 {subcategoryId:15,name:"电子设计",href:"#category-2/15"},
							 {subcategoryId:16,name:"机械设计",href:"#category-2/16"},
							 {subcategoryId:17,name:"服装设计",href:"#category-2/17"},
							 {subcategoryId:18,name:"设计－其他",href:"#category-2/18"},
								{subcategoryId:19,name:"营销策划",href:"#category-3/19"},
								 {subcategoryId:20,name:"广告创意",href:"#category-3/20"},
								 {subcategoryId:21,name:"创意视频",href:"#category-3/21"},
								 {subcategoryId:22,name:"市场－其他",href:"#category-3/22"},
								{subcategoryId:23,name:"本地生活",href:"#category-4/23"},
								 {subcategoryId:24,name:"社交类",href:"#category-4/24"},
								 {subcategoryId:25,name:"技术创新",href:"#category-4/25"},
								 {subcategoryId:26,name:"服务类",href:"#category-4/26"},
								 {subcategoryId:27,name:"校园创业－其他",href:"#category-4/27"},
						{subcategoryId:28,name:"志愿者活动",href:"#category-5/28"},
						 {subcategoryId:29,name:"爱的基金",href:"#category-5/29"},
						 {subcategoryId:30,name:"校园生活创意－其他",href:"#category-5/30"},
							{subcategoryId:31,name:"创业比赛",href:"#category-6/31"},
							 {subcategoryId:32,name:"设计比赛",href:"#category-6/32"},
							 {subcategoryId:33,name:"技能比赛",href:"#category-6/33"},
							 {subcategoryId:34,name:"学科竞赛",href:"#category-6/34"},
							 {subcategoryId:35,name:"营销竞赛",href:"#category-6/35"},
							 {subcategoryId:36,name:"比赛－其他",href:"#category-6/36"}
			    );
				var scanApp = angular.module('scanApp',['ngRoute','ngResource','ui.bootstrap','infinite-scroll']);
				
				scanApp.config(['$routeProvider',function($routeProvider){
					$routeProvider.when('/',{
						templateUrl:'scanproject-index-tpl',
						controller:'defaultCtl',
					}).when('/special-:specialId',{
						templateUrl:'scanproject-tpl',
						controller:'specialCtl'
					}).when('/category-:categoryId',{
						templateUrl:'scanproject-tpl',
						controller:'categoryCtl'
					}).when('/category-:categoryId/:subcategoryId',{
						templateUrl:'scanproject-tpl',
						controller:'categoryCtl'
					}).otherwise({
						redirectTo:'/'
					});		
				}]);
				scanApp.controller("navController",["$scope",function($scope,$rootScope){
					$scope.specialClick = function(specialId){
						$scope.specialId = specialId;
					}
					$scope.isActive = function(self, current){
						if(self == current)
							return true;
						else return false;
					}
				}]);
				scanApp.controller('defaultCtl',function($scope,$rootScope,$routeParams, $resource){
					$rootScope.cateTitle = "全部";
					//$scope.cateTitle = "全部123";
					//TODO 获得数据
					//$scope.projects = projects;
					$scope.projectLoaded = false;
				    var Project = $resource(API + 'project');
					var projects = Project.query(function() {
							$scope.projects = projects;
							$scope.projectLoaded = true;
					});
				});
				scanApp.controller('specialCtl',function($scope,$rootScope,$routeParams, $resource){
					//TODO 获得数据
					$rootScope.cateTitle = "全部";
					var last = -1;
					$scope.view_projects = new Array();
					$scope.projectLoaded = false;
				    var Project = $resource(API + 'project');
					var projects = Project.query({categoryId: 2}, function() {
							$scope.projects = projects;
							$scope.projectLoaded = true;
						    for(var i = 1; i <= 8; i++) {
						    	if(last + i < $scope.projects.length)
						    		$scope.view_projects.push($scope.projects[last + i]);
						    }
						    last = $scope.view_projects.length - 1;
					});
					$scope.loadMore = function() {	
						if($scope.projects != null){
					    for(var i = 1; i <= 8; i++) {
					    	if(last + i < $scope.projects.length)
					    		$scope.view_projects.push($scope.projects[last + i]);
					    }
					    last = $scope.view_projects.length - 1;
						}
				   };
				});
				scanApp.controller('categoryCtl',function($scope,$rootScope,$routeParams, $resource){
					//修改分类标题
					if($routeParams.specialId != null){
						$rootScope.cateTitle = "全部";
					}else if($routeParams.subcategoryId != null){
						$rootScope.cateTitle = subcategoryArrays[$routeParams.subcategoryId - 1].name;
					}else if($routeParams.categoryId != null){
						$rootScope.cateTitle = categoryTitle[$routeParams.categoryId-1];
					}
					var last = -1;
					$scope.view_projects = new Array();
					$scope.projectLoaded = false;
				    var Project = $resource(API + 'category/:categoryId/project');
					var projects = Project.query({categoryId: 2}, function() {
							$scope.projects = projects;
							$scope.projectLoaded = true;
						    for(var i = 1; i <= 8; i++) {
						    	if(last + i < $scope.projects.length)
						    		$scope.view_projects.push($scope.projects[last + i]);
						    }
						    last = $scope.view_projects.length - 1;
					});
					$scope.loadMore = function() {	
						if($scope.projects != null){
					    for(var i = 1; i <= 8; i++) {
					    	if(last + i < $scope.projects.length)
					    		$scope.view_projects.push($scope.projects[last + i]);
					    }
					    last = $scope.view_projects.length - 1;
						}
				   };
				});
				scanApp.controller("scanController", ["$scope", function ($scope) {
					$scope.page = {
						    size: 8,
						    index: 1
				    };
					$scope.hoverIn = function(){
					    this.hoverEdit = true;
					};

					$scope.hoverOut = function(){
					    this.hoverEdit = false;
					};
				}]);
				scanApp.filter('size', function() {
					  return function (items) {
					    if (!items)
					      return 0;
					    return items.length || 0
					  }
			   });
			   scanApp.filter('paging', function() {
					 return function (items, index, pageSize) {
					    if (!items)
					      return [];
					    var offset = (index - 1) * pageSize;
					    return items.slice(offset, offset + pageSize);
					 }
			  });
			   scanApp.filter('defaultImg',function(){
				   return function(item){
					   if(item==null || item =="")
						   return "/img/market.png";
					   else return "http://api.tongjo.com/files/"+item;
				   }
			   });
			   scanApp.filter('defaultDescription',function(){
				   return function(item){
					   if(item==null || item =="")
						   return "项目是指一系列独特的、复杂的并相互关联的活动，这些活动有着一个明确的目标或目的，必须在特定的时间、预算、资源限定内，依据规范完成";
					   else  return $($.parseHTML(item)).text();
					   
				   }
			   });
			   angular.bootstrap(document.getElementById("body"), [ 'scanApp' ]);
			});
</script>
{!/block!}