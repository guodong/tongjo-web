{!extends file='layout.html'!} {!block name=main!}
<style>
.navbar {
margin-bottom: 0px;
}
.bodyer {
margin-top: 0px;
}
.bodyer.wrapper{
width:100%;
}
.push {
height: 0px;
}
</style>
<div class="scanprojecttwo">
<div class="container-fluid">
<div class="mainpanel">
        <div class="left-nav" ng-controller="navController">
           <div class="special nav-section">
           <div>
           <div><a href="#special-1" ng-class="{current:isActive(1,specialId)}" ng-click="specialClick(1)">推荐</a></div>
           <div><a href="#special-2" ng-class="{current:isActive(2,specialId)}" ng-click="specialClick(2)">最新</a></div>
           <div><a href="#special-3" ng-class="{current:isActive(3,specialId)}" ng-click="specialClick(3)">最热</a></div>
           <div><a href="#special-4" ng-class="{current:isActive(4,specialId)}"ng-click="specialClick(4)">同校</a></div>
           </div>
           </div>
           <div class="category nav-section">
            <div class="title"><span>类别</span></div>
            <div class="dropdown">
            <a role="button" data-toggle="dropdown" class="btn btn-default cate-button" data-target="#">
                全部 <span class="caret"></span>
            </a>
    		<ul class="dropdown-menu multi-level" role="menu" aria-labelledby="dropdownMenu">
              <li class="dropdown-submenu">
                <a tabindex="-1" href="#">IT互联网</a>
                <ul class="dropdown-menu">
                  <li><a href="#category-1/1">数据分析</a></li>
                  <li><a href="#category-1/2">信息通信</a></li>	
                  <li><a href="#category-1/3">移动互联网</a></li>	
                  <li><a href="#category-1/4">智能硬件</a></li>	
                  <li><a href="#category-1/5">自动化</a></li>	
                  <li><a href="#category-1/6">网站开发</a></li>	
                  <li><a href="#category-1/7">软件开发</a></li>
                  <li><a href="#category-1/8">其他</a></li>
                </ul>
              </li>
              <li class="dropdown-submenu">
                <a tabindex="-1" href="#">设计</a>
                <ul class="dropdown-menu">
                  <li><a href="#category-2/9">艺术设计</a></li>
                  <li><a href="#category-2/10">交互设计</a></li>	
                  <li><a href="#category-2/11">网页设计</a></li>	
                  <li><a href="#category-2/12">动画设计</a></li>	
                  <li><a href="#category-2/13">建筑设计</a></li>	
                  <li><a href="#category-2/14">产品设计</a></li>	
                  <li><a href="#category-2/15">电子设计</a></li>
                  <li><a href="#category-2/16">机械设计</a></li>
                  <li><a href="#category-2/17">服装设计</a></li>
                  <li><a href="#category-2/18">其他</a></li>
                </ul>
              </li>
              <li class="dropdown-submenu">
                <a tabindex="-1" href="#">市场</a>
                <ul class="dropdown-menu">
                  <li><a href="#category-3/19">营销策划</a></li>
                  <li><a href="#category-3/20">广告创意</a></li>	
                  <li><a href="#category-3/21">创意视频</a></li>	
                  <li><a href="#category-3/22">其他</a></li>
                </ul>
              </li>
              <li class="dropdown-submenu">
                <a tabindex="-1" href="#">校园创业</a>
                <ul class="dropdown-menu">
                  <li><a href="#category-4/23">本地生活</a></li>
                  <li><a href="#category-4/24">社交类</a></li>	
                  <li><a href="#category-4/25">技术创新</a></li>	
                  <li><a href="#category-4/26">服务类</a></li>
                  <li><a href="#category-4/27">其他</a></li>
                </ul>
              </li>
             <li class="dropdown-submenu">
                <a tabindex="-1" href="#">校园生活创意</a>
                <ul class="dropdown-menu">
                <li><a href="#category-5/28">志愿者活动</a></li>
                  <li><a href="#category-5/29">爱的基金</a></li>	
                  <li><a href="#category-5/30">其他</a></li>
                </ul>
              </li>
             <li class="dropdown-submenu">
                <a tabindex="-1" href="#">比赛</a>
                <ul class="dropdown-menu">
                  <li><a href="#category-6/31">创业比赛</a></li>
                  <li><a href="#category-6/32">设计比赛</a></li>	
                  <li><a href="#category-6/33">技能比赛</a></li>	
                  <li><a href="#category-6/34">学科竞赛</a></li>	
                  <li><a href="#category-6/35">营销竞赛</a></li>	
                  <li><a href="#category-6/36">其他</a></li>
                </ul>
              </li>
            </ul>
        </div>
       </div>
           <div class="filter nav-section">
           <div class="title"><span>筛选</span></div>
           <div>
           <div class="checkbox"><label><input type="checkbox">同校</label></div>
           <div class="checkbox"><label><input type="checkbox">异校</label></div>
           <div class="checkbox"><label><input type="checkbox">团队</label></div>
           <div class="checkbox"><label><input type="checkbox">个人</label></div>
           </div>
           </div>
           <!-- <div class="feature">
           <div><span>需求</span></div>
           </div>
           <div class="rank">
           <div><span>排序</span></div>
           </div>-->
        </div>
        <div class="rightpanel">
            <div ng-controller="scanController">
            <div ng-view></div>
            </div>
        </div>
        </div>
</div>
<script>
	require(
			['angular', 'angular-route', 'angular-resource','ui-bootstrap','infinite-scroll'],
			function(angular,route,bootstrap) {
				var scanApp = angular.module('scanApp',['ngRoute','ngResource','ui.bootstrap','infinite-scroll']);
				
				scanApp.config(['$routeProvider',function($routeProvider){
					$routeProvider.when('/',{
						templateUrl:'scanproject-index-tpl',
						controller:'defaultCtl'
					}).when('/special-:specialId',{
						templateUrl:'scanproject-tpl',
						controller:'specialCtl'
					}).when('/category-:categoryId',{
						templateUrl:'scanproject-tpl',
						controller:'categoryCtl'
					}).when('/category-:categoryId/:subcategoryId',{
						templateUrl:'scanproject-tpl',
						controller:'categoryCtl'
					}).otherwise({
						redirectTo:'/'
					});		
				}]);
				scanApp.controller("navController",["$scope",function($scope){					
					$scope.specialClick = function(specialId){
						$scope.specialId = specialId;
					}
					$scope.isActive = function(self, current){
						if(self == current)
							return true;
						else return false;
					}
				}]);
				scanApp.controller('defaultCtl',function($scope,$routeParams, $resource){
					//TODO 获得数据
					//$scope.projects = projects;
					$scope.projectLoaded = false;
				    var Project = $resource(API + 'project');
					var projects = Project.query(function() {
							$scope.projects = projects;
							$scope.projectLoaded = true;
					});
				});
				scanApp.controller('specialCtl',function($scope,$routeParams, $resource){
					//TODO 获得数据
					var last = -1;
					$scope.view_projects = new Array();
					$scope.projectLoaded = false;
				    var Project = $resource(API + 'project');
					var projects = Project.query({categoryId: 2}, function() {
							$scope.projects = projects;
							$scope.projectLoaded = true;
						    for(var i = 1; i <= 8; i++) {
						    	if(last + i < $scope.projects.length)
						    		$scope.view_projects.push($scope.projects[last + i]);
						    }
						    last = $scope.view_projects.length - 1;
					});
					$scope.page.index = 1;
					$scope.loadMore = function() {			
					    for(var i = 1; i <= 8; i++) {
					    	if(last + i < $scope.projects.length)
					    		$scope.view_projects.push($scope.projects[last + i]);
					    }
					    last = $scope.view_projects.length - 1;
				   };
				});
				scanApp.controller('categoryCtl',function($scope,$routeParams, $resource){
					//TODO 获得数据
					var last = -1;
					$scope.view_projects = new Array();
					$scope.projectLoaded = false;
				    var Project = $resource(API + 'category/:categoryId/project');
					var projects = Project.query({categoryId: 2}, function() {
							$scope.projects = projects;
							$scope.projectLoaded = true;
						    for(var i = 1; i <= 8; i++) {
						    	if(last + i < $scope.projects.length)
						    		$scope.view_projects.push($scope.projects[last + i]);
						    }
						    last = $scope.view_projects.length - 1;
					});
					$scope.page.index = 1;
					$scope.loadMore = function() {			
					    for(var i = 1; i <= 8; i++) {
					    	if(last + i < $scope.projects.length)
					    		$scope.view_projects.push($scope.projects[last + i]);
					    }
					    last = $scope.view_projects.length - 1;
				   };
				});
				scanApp.controller("recomController",["$scope",'$resource',function($scope,$resource){
					//get recommendation projects
					$scope.recomProLoaded = false;
					var RecomProject = $resource(API + 'project');
					var recomProjects = RecomProject.query(function() {
							$scope.projects = recomProjects.slice($scope.recomdBatchStart,$scope.recomdBatchStart + 4);
							$scope.recomProLoaded = true;
					});
					
					$scope.recomdBatchStart = 1;
					$scope.hoverIn = function(){
					    this.hoverEdit = true;
					};

					$scope.hoverOut = function(){
					    this.hoverEdit = false;
					};
					
					$scope.change = function () {  
						//TODO 获取更多数据
					    $scope.recomdBatchStart =  ($scope.recomdBatchStart + 4) % recomProjects.length;
					    console.log($scope.recomdBatchStart);
					    if($scope.recomdBatchStart + 4 < recomProjects.length)
							$scope.projects = recomProjects.slice($scope.recomdBatchStart,$scope.recomdBatchStart + 4);
						else{
							$scope.projects = recomProjects.slice($scope.recomdBatchStart,recomProjects.length);
							$scope.projects = $scope.projects.concat(recomProjects.slice(0,($scope.recomdBatchStart + 4)%recomProjects.length));
						}
				   }
					
				}]);
				scanApp.controller("scanController", ["$scope", function ($scope) {
					$scope.page = {
						    size: 8,
						    index: 1
				    };
					$scope.hoverIn = function(){
					    this.hoverEdit = true;
					};

					$scope.hoverOut = function(){
					    this.hoverEdit = false;
					};
				}]);
				scanApp.filter('size', function() {
					  return function (items) {
					    if (!items)
					      return 0;
					    return items.length || 0
					  }
			   });
			   scanApp.filter('paging', function() {
					 return function (items, index, pageSize) {
					    if (!items)
					      return [];
					    var offset = (index - 1) * pageSize;
					    return items.slice(offset, offset + pageSize);
					 }
			  });
			   scanApp.filter('defaultImg',function(){
				   return function(item){
					   if(item==null || item =="")
						   return "/img/market.png";
					   else return "http://api.tongjo.com/files/"+item;
				   }
			   });
			   scanApp.filter('defaultDescription',function(){
				   return function(item){
					   if(item==null || item =="")
						   return "项目是指一系列独特的、复杂的并相互关联的活动，这些活动有着一个明确的目标或目的，必须在特定的时间、预算、资源限定内，依据规范完成";
					   else  return $($.parseHTML(item)).text();
					   
				   }
			   });
			   angular.bootstrap(document.getElementById("body"), [ 'scanApp' ]);
			});
</script>
{!/block!}