{!extends file='layout.html'!} {!block name=main!}
<link href="/lib/bootstrap-datepicker/datepicker3.css" rel="stylesheet">

<div class="newteam container-fluid">
	<div ng-controller="newteamController">
		<div class="col-md-2"></div>
		<form class="form-horizontal col-md-8" role="form" ng-submit="processForm()"
			name="newteamForm">
			<div class="form-group">
				<label class="col-md-3 control-label">团队名称：</label>
				<div class="col-md-9 inputline">
					<input type="text" class="form-control inputtext"
						id="inputteamname" placeholder="团队名称" name="name" ng-model="team.name" required>
				</div>
			</div>

			<div class="form-group">
				<label class="col-md-3 control-label">团队人数：</label>
				<div class="input-group col-md-9">
					<input type="text" class="form-control" name="teammember_all" ng-model="team.teammember_all"
						placeholder="团队需要的总人数" required>
					<div class="input-group-btn">
						<button type="button" class="btn btn-default dropdown-toggle"
							data-toggle="dropdown" aria-expanded="false">
							<span class="caret"></span>
						</button>
						<ul class="dropdown-menu dropdown-menu-right" role="menu">
							<li><a href="#" ng-click="setteammember('1')">1</a></li>
							<li><a href="#" ng-click="setteammember('2')">2</a></li>
							<li><a href="#" ng-click="setteammember('3')">3</a></li>
							<li><a href="#" ng-click="setteammember('4')">4</a></li>
							<li><a href="#" ng-click="setteammember('5')">5</a></li>
							<li role="presentation" class="divider"></li>
							<li><a href="#" ng-click="setteammember('6')">6</a></li>
							<li><a href="#" ng-click="setteammember('7')">7</a></li>
							<li><a href="#" ng-click="setteammember('8')">8</a></li>
							<li><a href="#" ng-click="setteammember('9')">9</a></li>
							<li><a href="#" ng-click="setteammember('10')">10</a></li>
						</ul>
					</div>
				</div>
			</div>

			<div class="form-group">
				<label class="col-md-3 control-label">截止日期：</label>
				<div class="inputline col-md-9">
					<input type="text" class="form-control inputtext datepicker" name="signup_time" ng-model="team.signup_time" data-provide="datepicker" 
						placeholder="在这里填写团队报名截止日期" required data-date-format="yyyy-mm-dd" autoclose="true">
				</div>
			</div>

			<div class="form-group">
				<label class="col-md-3 control-label">团队简介：</label>
				<div class="input-group col-md-9">
					<textarea cols="5" type="text" class="form-control mutilinput"
						placeholder="在这里描述一下你的团队" name="description" ng-model="team.description" required></textarea>
				</div>
			</div>


			<div class="form-group">
				<label class="col-md-5 control-label">是否开启报名确认：</label>
				<div class="input-group col-md-7" style="text-align: left">

					<label class="radio-inline" style="margin-left: 5px"> <input
						type="radio" name="inlineRadioOptions" id="inlineRadio1"
						value="0" checked="checked"> 开启
					</label> <label class="radio-inline" style="margin-left: 30px"> <input
						type="radio" name="inlineRadioOptions" id="inlineRadio2"
						value="1"> 关闭
					</label>


				</div>
			</div>

			<div class="form-group" style="margin-top: 30px; text-align: center">
				<div class="col-md-3"></div>
				<button type="submit" class="btn btn-success summitbutton"
					ng-disabled="newteamForm.$invalid">立 即 创 建 团 队</button>

			</div>
		</form>
		<div class="col-md-2"></div>
	</div>
	<div class="col-md-3"></div>
</div>

<script src="/lib/bootstrap-datepicker/bootstrap-datepicker.js"></script>
<script src="/lib/bootstrap-datepicker/bootstrap-datepicker.zh-CN.js"></script>
<script>
	
	/* { 'get':    {method:'GET'},
	  'save':   {method:'POST'},
	  'query':  {method:'GET', isArray:true},
	  'remove': {method:'DELETE'},
	  'delete': {method:'DELETE'}
	}; */


	require([ 'angular', 'angular-route', 'angular-resource' ], function(
			angular) {
		var app = angular.module('newteamApp', [ 'ngRoute', 'ngResource' ]);
		app.controller('newteamController', function($scope,$resource) {
			
			$('.datepicker').datepicker({
				startDate: '1d',
				autoclose: true,
				language: 'zh-CN', 
			});
			
			var pid = window.location.pathname.replace(/\/newteam\/(\d+)$/, '$1');
			
			/* console.log(pid);  */
			
			
			var Team = $resource(API + 'team');
			/* console.log(localStorage.uid); */
			$scope.team = {};
			
			$scope.processForm = function(){
				$scope.team.is_signup = $("input[type='radio']:checked").val();
				$scope.team.user_id = localStorage.uid;
				$scope.team.project_id = pid;
				t = new Team($scope.team);
				t.$save(null,function(team){ 
		            console.log(team);
		            if(team.id > 0){
		            	/* location.href = "/team/"+team.id; */
		            }
		        });
				/* location.href = "/team";  */
				
		        /*  $.ajax({
		      		   type: "POST",
		      		   url: API+"team",
		      		 	$scope.team.is_signup = $("input[type='radio']:checked").val();
		      		   data: $scope.team,
		      		   success: function(msg){
		      		       console.log(msg);
		      		     location.href = "/team";
		      		   },
		      	       error: function(data) {
		      	    	   console.log(data);
		                }
		      	});     */
			};
			
			$scope.setteammember = function(number){
				$scope.team.teammember_all=number;
			};
			
		});
		
		angular.bootstrap(document.getElementById("body"), [ 'newteamApp' ]);
	});
</script>
{!/block!}
